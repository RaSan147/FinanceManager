<!DOCTYPE html>
<html lang="en">
<head>
	{% include "includes/initial_dark_mode.html" %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Tracker - {% block title %}{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    {% block extra_css %}{% endblock %}

	
	<!-- Right before closing head -->
    <script defer src="{{ url_for('static', filename='js/dark_mode.js') }}"></script>
    {% include "includes/dark_mode_toggle.html" %}
</head>
<body class="{{ 'dark-mode' if session.get('dark_mode') else '' }}">
	<main>
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
			<div class="container">
				<a class="navbar-brand" href="{{ url_for('index') }}">Finance Tracker</a>
				<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav me-auto">
						{% if current_user.is_authenticated %}
						<li class="nav-item">
							<a class="nav-link" href="{{ url_for('index') }}">Dashboard</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ url_for('transactions') }}">Transactions</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ url_for('goals') }}">Goals</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ url_for('loans') }}">Loans</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ url_for('analysis') }}">Analysis</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ url_for('purchase_advisor') }}">
								<i class="bi bi-robot"></i> Purchase Advisor
							</a>
						</li>
						{% endif %}
					</ul>
					<ul class="navbar-nav">
						{% if current_user.is_authenticated %}
						<li class="nav-item dropdown">
							<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
								<i class="bi bi-person-circle"></i> {{ current_user.name }}
							</a>
							<ul class="dropdown-menu dropdown-menu-end">
								<li class="nav-item">
									<a class="nav-link" href="{{ url_for('profile') }}">Profile</a>
								</li>

								<li><hr class="dropdown-divider"></li>
								<li><a class="dropdown-item" href="{{ url_for('logout') }}">Logout</a></li>
							</ul>
						</li>
						{% else %}
						<li class="nav-item">
							<a class="nav-link" href="{{ url_for('login') }}">Login</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="{{ url_for('register') }}">Register</a>
						</li>
						{% endif %}
					</ul>
				</div>
			</div>
		</nav>

		<div class="container mt-4">
			{% with messages = get_flashed_messages(with_categories=true) %}
				{% if messages %}
					{% for item in messages %}
						{# Handle normal (category, message) tuples #}
						{% if item is sequence and item|length == 2 %}
							{% set category = item[0] %}
							{% set message = item[1] %}
						{# Handle possible mapping representation of tuples in some contexts, e.g., {' t': ['cat','msg']} #}
						{% elif item is mapping and (' t' in item or 't' in item) %}
							{% set pair = item[' t'] if ' t' in item else item['t'] %}
							{% set category = pair[0] %}
							{% set message = pair[1] %}
						{# Fallback to simple string message #}
						{% else %}
							{% set category = 'info' %}
							{% set message = item %}
						{% endif %}
						{# Normalize unexpected categories to Bootstrap variants #}
						{% set cat = category if category in ['primary','secondary','success','danger','warning','info','light','dark'] else 'info' %}
						<div class="alert alert-{{ cat }} alert-dismissible fade show" role="alert">
							{{ message }}
							<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
						</div>
					{% endfor %}
				{% endif %}
			{% endwith %}

			{% block content %}{% endblock %}
		</div>

	</main>

	<footer class="mt-5 py-3">
		<div class="container text-center">
			<p class="mb-0">Finance Tracker Â© 2025</p>
			{% include 'includes/perf_footer.html' %}
		</div>
	</footer>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script src="{{ url_for('static', filename='js/currency.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>